<!DOCTYPE html>
<html>
<head>
  <title>Test Save</title>
</head>
<body>
  <h1>Manual Save Test</h1>
  <button id="saveBtn">Click to Save Salt System</button>

  <script>
    const binUrl = "https://api.jsonbin.io/v3/b/681df1438a456b796c96acaa";
    const apiKey = "S2a1S0bM9xij4ZkDrZbZiUr30LJ3O0Rf00l1UAZpMekm2zxZPa1BoHqYbD10";
    const clientKey = "taylor";

    async function saveSelection() {
      try {
        const getRes = await fetch(`${binUrl}/latest`, {
          headers: { "X-Master-Key": apiKey }
        });
        const full = await getRes.json();
        const record = full.record || {};

        if (!record[clientKey]) record[clientKey] = {};
        record[clientKey].sanitizing_system = "Aqua Rite Saltwater System $1995";

        const putRes = await fetch(binUrl, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": apiKey
          },
          body: JSON.stringify(record)
        });

        const result = await putRes.text();
        alert(putRes.ok ? "Saved!" : "ERROR:\n" + result);
        console.log("PUT Response:", result);
      } catch (err) {
        alert("Exception: " + err.message);
      }
    }

    document.getElementById("saveBtn").addEventListener("click", saveSelection);
  </script>
</body>
</html>
